version: '3.5'
services:
  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: swiftwave_development
      POSTGRES_PASSWORD: postgres
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql@14/data/pgdata
    ports:
      - target: 5432
        published: 5432
        protocol: tcp
        mode: host
  haproxy:
    image: "haproxytech/haproxy-debian:2.9"
    volumes:
      - /app/.data/haproxy:/usr/local/etc/haproxy:rw
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.swiftwave_controlplane_node==true
    networks:
      - swarm_network
    ports:
      - target: 5555
        published: 5555
        protocol: tcp
        mode: host
  dashboard:
    image: "ghcr.io/swiftwave-org/dashboard:develop"
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.swiftwave_controlplane_node==true
    ports:
      - target: 80
        published: 1212
        protocol: tcp
        mode: host
volumes:
  postgres_data:
networks:
  swarm_network:
    external: true
